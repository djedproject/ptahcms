<div class="col-xs-12">
<div class="page-header">
  <h1>Local roles</h1>
<form class="form-inline" method="post" action="${request.url}">
    <div class="form-group">
      <label class="sr-only" for="years">Search years</label>
      <input type="search" class="form-control" style="width:12em;" name="term" list="principals" placeholder="Users and groups..." value="${view.term}" />
        <datalist id="principals">
            <tal:block tal:repeat="principal view.principals">
              <option>${principal}</option>
            </tal:block>
        </datalist>
    </div>
    <button type="submit" class="btn btn-default" name="form.buttons.search">
        <span class="glyphicon glyphicon-search"></span>
    </button>
</form>
    <a href="${request.url}">Show all local assigned roles</a>
</div>

<p tal:condition="not view.term and not view.principals">
  There are no local roles defined.
</p>

<p tal:condition="view.term and not view.principals">
  There are no users and groups found.
</p>

<div tal:condition="view.principals">
  <form class="form-horizontal" method="post" action="${request.url}">
    <table class="table table-striped">
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th tal:repeat="role view.roles">
            ${role.title}
          </th>
        </tr>
      </thead>
      <tbody>
        <tr tal:repeat="principal view.principals">
          <td tal:condition="getattr(principal, 'name', None)">${principal.name}
            <input type="hidden" name="userid-${principal.__uri__}" value="on" />
          </td>
          <td tal:condition="not getattr(principal, 'name', None) and getattr(principal, 'title', None)">${principal.title}
            <input type="hidden" name="userid-${principal.__uri__}" value="on" />
          </td>
          <td>${principal.__type__.title}
          </td>
          <td tal:repeat="role view.roles" tal:define="local_roles view.local_roles.get(principal.__uri__, [])">
            <input tal:condition="role.id in local_roles" type="checkbox" name="${'user-%s-%s'%(principal.__uri__, role.id)}"
                    checked />
            <input tal:condition="not role.id in local_roles" type="checkbox" name="${'user-%s-%s'%(principal.__uri__, role.id)}"
                    />
          </td>
        </tr>
      </tbody>
    </table>
    <div class="form-group">
      <div class="col-xs-12">
        <tal:block content="structure request.render_tmpl(view.tmpl_actions, view)" />
      </div>
    </div>
  </form>
</div>
</div>
